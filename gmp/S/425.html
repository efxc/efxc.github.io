<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<title>demos/expr/expr.c</title>
<meta name='robots' content='noindex,nofollow' />
<meta name='generator' content='GLOBAL-6.6.3' />
<meta http-equiv='Content-Style-Type' content='text/css' />
<link rel='stylesheet' type='text/css' href='../style.css' />
</head>
<body>
<a id='TOP' name='TOP'></a><h2 class='header'><a href='../mains.html'>root</a>/<a href='../files/2095.html'>demos</a>/<a href='../files/2097.html'>expr</a>/expr.c</h2>
<em class='comment'>/* [&lt;][&gt;]<a href='#L148'>[^]</a><a href='#L371'>[v]</a>[top]<a href='#BOTTOM'>[bottom]</a><a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</em>
<hr />
<h2 class='header'>DEFINITIONS</h2>
This source file includes following definitions.
<ol>
<li><a href='#L148' title='Defined at 148.'>lookahead</a></li>
<li><a href='#L371' title='Defined at 371.'>mpexpr_evaluate</a></li>
</ol>
<hr />
<pre>
<a id='L1' name='L1'></a><em class='comment'>/* mpexpr_evaluate -- shared code for simple expression evaluation</em>
<a id='L2' name='L2'></a><em class='comment'></em>
<a id='L3' name='L3'></a><em class='comment'>Copyright 2000-2002, 2004 Free Software Foundation, Inc.</em>
<a id='L4' name='L4'></a><em class='comment'></em>
<a id='L5' name='L5'></a><em class='comment'>This file is part of the GNU MP Library.</em>
<a id='L6' name='L6'></a><em class='comment'></em>
<a id='L7' name='L7'></a><em class='comment'>The GNU MP Library is free software; you can redistribute it and/or modify</em>
<a id='L8' name='L8'></a><em class='comment'>it under the terms of either:</em>
<a id='L9' name='L9'></a><em class='comment'></em>
<a id='L10' name='L10'></a><em class='comment'>  * the GNU Lesser General Public License as published by the Free</em>
<a id='L11' name='L11'></a><em class='comment'>    Software Foundation; either version 3 of the License, or (at your</em>
<a id='L12' name='L12'></a><em class='comment'>    option) any later version.</em>
<a id='L13' name='L13'></a><em class='comment'></em>
<a id='L14' name='L14'></a><em class='comment'>or</em>
<a id='L15' name='L15'></a><em class='comment'></em>
<a id='L16' name='L16'></a><em class='comment'>  * the GNU General Public License as published by the Free Software</em>
<a id='L17' name='L17'></a><em class='comment'>    Foundation; either version 2 of the License, or (at your option) any</em>
<a id='L18' name='L18'></a><em class='comment'>    later version.</em>
<a id='L19' name='L19'></a><em class='comment'></em>
<a id='L20' name='L20'></a><em class='comment'>or both in parallel, as here.</em>
<a id='L21' name='L21'></a><em class='comment'></em>
<a id='L22' name='L22'></a><em class='comment'>The GNU MP Library is distributed in the hope that it will be useful, but</em>
<a id='L23' name='L23'></a><em class='comment'>WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY</em>
<a id='L24' name='L24'></a><em class='comment'>or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License</em>
<a id='L25' name='L25'></a><em class='comment'>for more details.</em>
<a id='L26' name='L26'></a><em class='comment'></em>
<a id='L27' name='L27'></a><em class='comment'>You should have received copies of the GNU General Public License and the</em>
<a id='L28' name='L28'></a><em class='comment'>GNU Lesser General Public License along with the GNU MP Library.  If not,</em>
<a id='L29' name='L29'></a><em class='comment'>see https://www.gnu.org/licenses/.  */</em>
<a id='L30' name='L30'></a>
<a id='L31' name='L31'></a><em class='sharp'>#include</em> &lt;ctype.h&gt;
<a id='L32' name='L32'></a><em class='sharp'>#include</em> &lt;stdio.h&gt;
<a id='L33' name='L33'></a><em class='sharp'>#include</em> &lt;string.h&gt;
<a id='L34' name='L34'></a>
<a id='L35' name='L35'></a><em class='sharp'>#include</em> "gmp.h"
<a id='L36' name='L36'></a><em class='sharp'>#include</em> "<a href='434.html'>expr-impl.h</a>"
<a id='L37' name='L37'></a>
<a id='L38' name='L38'></a>
<a id='L39' name='L39'></a><em class='comment'>/* Change this to "#define TRACE(x) x" to get some traces.  The trace</em>
<a id='L40' name='L40'></a><em class='comment'>   printfs junk up the code a bit, but it's very hard to tell what's going</em>
<a id='L41' name='L41'></a><em class='comment'>   on without them.  Set MPX_TRACE to a suitable output function for the</em>
<a id='L42' name='L42'></a><em class='comment'>   mpz/mpq/mpf being run (if you have the wrong trace function it'll</em>
<a id='L43' name='L43'></a><em class='comment'>   probably segv).  */</em>
<a id='L44' name='L44'></a>
<a id='L45' name='L45'></a><em class='sharp'>#define</em> <a href='../R/1381.html' title='Multiple referred from 183 places.'>TRACE</a>(x)
<a id='L46' name='L46'></a><em class='sharp'>#define</em> <a href='../R/816.html' title='Multiple referred from 12 places.'>MPX_TRACE</a>  <a href='../S/187.html#L76' title='Defined at 76 in tests/trace.c.'>mpz_trace</a>
<a id='L47' name='L47'></a>
<a id='L48' name='L48'></a>
<a id='L49' name='L49'></a><em class='comment'>/* A few helper macros copied from gmp-impl.h */</em>
<a id='L50' name='L50'></a><em class='sharp'>#define</em> <a href='../R/13.html' title='Multiple referred from 3 places.'>ALLOCATE_FUNC_TYPE</a>(n,<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>) \
<a id='L51' name='L51'></a>  ((<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> *) (*allocate_func) ((n) * <strong class='reserved'>sizeof</strong> (<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>)))
<a id='L52' name='L52'></a><em class='sharp'>#define</em> ALLOCATE_FUNC_LIMBS(n)   <a href='../S/425.html#L50' title='Defined at 50 in demos/expr/expr.c.'>ALLOCATE_FUNC_TYPE</a> (n, <a href='../D/2745.html' title='Multiple defined in 2 places.'>mp_limb_t</a>)
<a id='L53' name='L53'></a><em class='sharp'>#define</em> <a href='../R/1013.html' title='Multiple referred from 2 places.'>REALLOCATE_FUNC_TYPE</a>(p, old_size, new_size, <a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>) \
<a id='L54' name='L54'></a>  ((<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> *) (*reallocate_func)                            \
<a id='L55' name='L55'></a>   (p, (old_size) * <strong class='reserved'>sizeof</strong> (<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>), (new_size) * <strong class='reserved'>sizeof</strong> (<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>)))
<a id='L56' name='L56'></a><em class='sharp'>#define</em> REALLOCATE_FUNC_LIMBS(p, old_size, new_size) \
<a id='L57' name='L57'></a>  <a href='../S/425.html#L53' title='Defined at 53 in demos/expr/expr.c.'>REALLOCATE_FUNC_TYPE</a>(p, old_size, new_size, <a href='../D/2745.html' title='Multiple defined in 2 places.'>mp_limb_t</a>)
<a id='L58' name='L58'></a><em class='sharp'>#define</em> <a href='../R/360.html' title='Multiple referred from 3 places.'>FREE_FUNC_TYPE</a>(p,n,<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>) (*free_func) (p, (n) * <strong class='reserved'>sizeof</strong> (<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>))
<a id='L59' name='L59'></a><em class='sharp'>#define</em> FREE_FUNC_LIMBS(p,n)     <a href='../S/425.html#L58' title='Defined at 58 in demos/expr/expr.c.'>FREE_FUNC_TYPE</a> (p, n, <a href='../D/2745.html' title='Multiple defined in 2 places.'>mp_limb_t</a>)
<a id='L60' name='L60'></a><em class='sharp'>#define</em> <a href='../R/33.html' title='Multiple referred from 1500 places.'>ASSERT</a>(x)
<a id='L61' name='L61'></a>
<a id='L62' name='L62'></a>
<a id='L63' name='L63'></a>
<a id='L64' name='L64'></a><em class='comment'>/* All the error strings are just for diagnostic traces.  Only the error</em>
<a id='L65' name='L65'></a><em class='comment'>   code is actually returned.  */</em>
<a id='L66' name='L66'></a><em class='sharp'>#define</em> <a href='../R/317.html' title='Multiple referred from 24 places.'>ERROR</a>(str,code)                 \
<a id='L67' name='L67'></a>  <em class='brace'>{</em>                                     \
<a id='L68' name='L68'></a>    <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("%s\n", str));       \
<a id='L69' name='L69'></a>    p-&gt;error_code = (code);             \
<a id='L70' name='L70'></a>    <strong class='reserved'>goto</strong> done;                          \
<a id='L71' name='L71'></a>  <em class='brace'>}</em>
<a id='L72' name='L72'></a>
<a id='L73' name='L73'></a>
<a id='L74' name='L74'></a><em class='sharp'>#define</em> <a href='../R/1012.html' title='Multiple referred from 2 places.'>REALLOC</a>(ptr, alloc, incr, <a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>)                         \
<a id='L75' name='L75'></a>  <strong class='reserved'>do</strong> <em class='brace'>{</em>                                                          \
<a id='L76' name='L76'></a>    <strong class='reserved'>int</strong>  new_alloc = (alloc) + (incr);                          \
<a id='L77' name='L77'></a>    ptr = <a href='../S/425.html#L53' title='Defined at 53 in demos/expr/expr.c.'>REALLOCATE_FUNC_TYPE</a> (ptr, alloc, new_alloc, <a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>);   \
<a id='L78' name='L78'></a>    (alloc) = new_alloc;                                        \
<a id='L79' name='L79'></a>  <em class='brace'>}</em> <strong class='reserved'>while</strong> (0)
<a id='L80' name='L80'></a>
<a id='L81' name='L81'></a>
<a id='L82' name='L82'></a><em class='comment'>/* data stack top element */</em>
<a id='L83' name='L83'></a><em class='sharp'>#define</em> <a href='../R/1115.html' title='Multiple referred from 9 places.'>SP</a>   (p-&gt;data_stack + p-&gt;data_top)
<a id='L84' name='L84'></a>
<a id='L85' name='L85'></a><em class='comment'>/* Make sure there's room for another data element above current top.</em>
<a id='L86' name='L86'></a><em class='comment'>   reallocate_func is fetched for when this macro is used in lookahead(). */</em>
<a id='L87' name='L87'></a><em class='sharp'>#define</em> <a href='../R/194.html' title='Multiple referred from 2 places.'>DATA_SPACE</a>()                                                    \
<a id='L88' name='L88'></a>  <strong class='reserved'>do</strong> <em class='brace'>{</em>                                                                  \
<a id='L89' name='L89'></a>    <strong class='reserved'>if</strong> (p-&gt;data_top + 1 &gt;= p-&gt;data_alloc)                               \
<a id='L90' name='L90'></a>      <em class='brace'>{</em>                                                                 \
<a id='L91' name='L91'></a>        <strong class='reserved'>void</strong> *(*reallocate_func) (<strong class='reserved'>void</strong> *, size_t, size_t);              \
<a id='L92' name='L92'></a>        <a href='../D/2744.html' title='Multiple defined in 2 places.'>mp_get_memory_functions</a> (NULL, &amp;reallocate_func, NULL);         \
<a id='L93' name='L93'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("grow stack from %d\n", p-&gt;data_alloc));         \
<a id='L94' name='L94'></a>        <a href='../S/425.html#L74' title='Defined at 74 in demos/expr/expr.c.'>REALLOC</a> (p-&gt;data_stack, p-&gt;data_alloc, 20, <strong class='reserved'>union</strong> <a href='../S/434.html#L46' title='Defined at 46 in demos/expr/expr-impl.h.'>mpX_t</a>);        \
<a id='L95' name='L95'></a>      <em class='brace'>}</em>                                                                 \
<a id='L96' name='L96'></a>    <a href='../D/34.html' title='Multiple defined in 3 places.'>ASSERT</a> (p-&gt;data_top + 1 &lt;= p-&gt;data_inited);                         \
<a id='L97' name='L97'></a>    <strong class='reserved'>if</strong> (p-&gt;data_top + 1 == p-&gt;data_inited)                              \
<a id='L98' name='L98'></a>      <em class='brace'>{</em>                                                                 \
<a id='L99' name='L99'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("initialize %d\n", p-&gt;data_top + 1));            \
<a id='L100' name='L100'></a>        (*p-&gt;mpX_init) (&amp;p-&gt;data_stack[p-&gt;data_top + 1], p-&gt;prec);      \
<a id='L101' name='L101'></a>        p-&gt;data_inited++;                                               \
<a id='L102' name='L102'></a>      <em class='brace'>}</em>                                                                 \
<a id='L103' name='L103'></a>  <em class='brace'>}</em> <strong class='reserved'>while</strong> (0)
<a id='L104' name='L104'></a>
<a id='L105' name='L105'></a><em class='sharp'>#define</em> <a href='../R/190.html' title='Multiple referred from 3 places.'>DATA_PUSH</a>()                             \
<a id='L106' name='L106'></a>  <strong class='reserved'>do</strong> <em class='brace'>{</em>                                          \
<a id='L107' name='L107'></a>    p-&gt;data_top++;                              \
<a id='L108' name='L108'></a>    <a href='../D/34.html' title='Multiple defined in 3 places.'>ASSERT</a> (p-&gt;data_top &lt; p-&gt;data_alloc);       \
<a id='L109' name='L109'></a>    <a href='../D/34.html' title='Multiple defined in 3 places.'>ASSERT</a> (p-&gt;data_top &lt; p-&gt;data_inited);      \
<a id='L110' name='L110'></a>  <em class='brace'>}</em> <strong class='reserved'>while</strong> (0)
<a id='L111' name='L111'></a>
<a id='L112' name='L112'></a><em class='comment'>/* the last stack entry is never popped, so top&gt;=0 will be true */</em>
<a id='L113' name='L113'></a><em class='sharp'>#define</em> <a href='../R/189.html' title='Multiple referred from 3 places.'>DATA_POP</a>(n)             \
<a id='L114' name='L114'></a>  <strong class='reserved'>do</strong> <em class='brace'>{</em>                          \
<a id='L115' name='L115'></a>    p-&gt;data_top -= (n);         \
<a id='L116' name='L116'></a>    <a href='../D/34.html' title='Multiple defined in 3 places.'>ASSERT</a> (p-&gt;data_top &gt;= 0);  \
<a id='L117' name='L117'></a>  <em class='brace'>}</em> <strong class='reserved'>while</strong> (0)
<a id='L118' name='L118'></a>
<a id='L119' name='L119'></a>
<a id='L120' name='L120'></a><em class='comment'>/* lookahead() parses the next token.  Return 1 if successful, with some</em>
<a id='L121' name='L121'></a><em class='comment'>   extra data.  Return 0 if fail, with reason in p-&gt;error_code.</em>
<a id='L122' name='L122'></a><em class='comment'></em>
<a id='L123' name='L123'></a><em class='comment'>   "prefix" is MPEXPR_TYPE_PREFIX if an operator with that attribute is</em>
<a id='L124' name='L124'></a><em class='comment'>   preferred, or 0 if an operator without is preferred. */</em>
<a id='L125' name='L125'></a>
<a id='L126' name='L126'></a><em class='sharp'>#define</em> <a href='../R/1352.html' title='Multiple referred from 3 places.'>TOKEN_EOF</a>         -1   <em class='comment'>/* no extra data */</em>
<a id='L127' name='L127'></a><em class='sharp'>#define</em> <a href='../R/1356.html' title='Multiple referred from 5 places.'>TOKEN_VALUE</a>       -2   <em class='comment'>/* pushed onto data stack */</em>
<a id='L128' name='L128'></a><em class='sharp'>#define</em> <a href='../R/1355.html' title='Multiple referred from 6 places.'>TOKEN_OPERATOR</a>    -3   <em class='comment'>/* stored in p-&gt;token_op */</em>
<a id='L129' name='L129'></a><em class='sharp'>#define</em> <a href='../R/1353.html' title='Multiple referred from 2 places.'>TOKEN_FUNCTION</a>    -4   <em class='comment'>/* stored in p-&gt;token_op */</em>
<a id='L130' name='L130'></a>
<a id='L131' name='L131'></a><em class='sharp'>#define</em> <a href='../S/425.html#L452' title='Referred from 452 in demos/expr/expr.c.'>TOKEN_NAME</a>(n)                           \
<a id='L132' name='L132'></a>  ((n) == <a href='../S/425.html#L126' title='Defined at 126 in demos/expr/expr.c.'>TOKEN_EOF</a> ? "TOKEN_EOF"               \
<a id='L133' name='L133'></a>   : (n) == <a href='../S/425.html#L127' title='Defined at 127 in demos/expr/expr.c.'>TOKEN_VALUE</a> ? "TOKEN_VALUE"         \
<a id='L134' name='L134'></a>   : (n) == <a href='../S/425.html#L128' title='Defined at 128 in demos/expr/expr.c.'>TOKEN_OPERATOR</a> ? "TOKEN_OPERATOR"   \
<a id='L135' name='L135'></a>   : (n) == <a href='../S/425.html#L127' title='Defined at 127 in demos/expr/expr.c.'>TOKEN_VALUE</a> ? "TOKEN_FUNCTION"      \
<a id='L136' name='L136'></a>   : "UNKNOWN TOKEN")
<a id='L137' name='L137'></a>
<a id='L138' name='L138'></a><em class='comment'>/* Functions default to being parsed as whole words, operators to match just</em>
<a id='L139' name='L139'></a><em class='comment'>   at the start of the string.  The type flags override this. */</em>
<a id='L140' name='L140'></a><em class='sharp'>#define</em> <a href='../S/425.html#L187' title='Referred from 187 in demos/expr/expr.c.'>WHOLEWORD</a>(op)                           \
<a id='L141' name='L141'></a>  (op-&gt;precedence == 0                          \
<a id='L142' name='L142'></a>   ? (! (op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L109' title='Defined at 109 in demos/expr/expr.h.'>MPEXPR_TYPE_OPERATOR</a>))      \
<a id='L143' name='L143'></a>   :   (op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L108' title='Defined at 108 in demos/expr/expr.h.'>MPEXPR_TYPE_WHOLEWORD</a>))
<a id='L144' name='L144'></a>
<a id='L145' name='L145'></a><em class='sharp'>#define</em> <a href='../S/425.html#L155' title='Referred from 155 in demos/expr/expr.c.'>isasciispace</a>(c)   (isascii (c) &amp;&amp; isspace (c))
<a id='L146' name='L146'></a>
<a id='L147' name='L147'></a><strong class='reserved'>static</strong> <strong class='reserved'>int</strong>
<a id='L148' name='L148'></a><a href='../S/425.html#L325' title='Referred from 325 in demos/expr/expr.c.'>lookahead</a> (<strong class='reserved'>struct</strong> <a href='../S/434.html#L88' title='Defined at 88 in demos/expr/expr-impl.h.'>mpexpr_parse_t</a> *p, <strong class='reserved'>int</strong> prefix)
<a id='L149' name='L149'></a><em class='brace'>{</em>
<a id='L150' name='L150'></a>  <strong class='reserved'>const</strong> <strong class='reserved'>struct</strong> <a href='../S/429.html#L118' title='Defined at 118 in demos/expr/expr.h.'>mpexpr_operator_t</a>  *op, *op_found;
<a id='L151' name='L151'></a>  size_t  oplen, oplen_found, wlen;
<a id='L152' name='L152'></a>  <strong class='reserved'>int</strong>     i;
<a id='L153' name='L153'></a>
<a id='L154' name='L154'></a>  <em class='comment'>/* skip white space */</em>
<a id='L155' name='L155'></a>  <strong class='reserved'>while</strong> (p-&gt;elen &gt; 0 &amp;&amp; <a href='../S/425.html#L145' title='Defined at 145 in demos/expr/expr.c.'>isasciispace</a> (*p-&gt;e))
<a id='L156' name='L156'></a>    p-&gt;e++, p-&gt;elen--;
<a id='L157' name='L157'></a>
<a id='L158' name='L158'></a>  <strong class='reserved'>if</strong> (p-&gt;elen == 0)
<a id='L159' name='L159'></a>    <em class='brace'>{</em>
<a id='L160' name='L160'></a>      <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("lookahead EOF\n"));
<a id='L161' name='L161'></a>      p-&gt;token = <a href='../S/425.html#L126' title='Defined at 126 in demos/expr/expr.c.'>TOKEN_EOF</a>;
<a id='L162' name='L162'></a>      <strong class='reserved'>return</strong> 1;
<a id='L163' name='L163'></a>    <em class='brace'>}</em>
<a id='L164' name='L164'></a>
<a id='L165' name='L165'></a>  <a href='../S/425.html#L87' title='Defined at 87 in demos/expr/expr.c.'>DATA_SPACE</a> ();
<a id='L166' name='L166'></a>
<a id='L167' name='L167'></a>  <em class='comment'>/* Get extent of whole word. */</em>
<a id='L168' name='L168'></a>  <strong class='reserved'>for</strong> (wlen = 0; wlen &lt; p-&gt;elen; wlen++)
<a id='L169' name='L169'></a>    <strong class='reserved'>if</strong> (! <a href='../S/434.html#L37' title='Defined at 37 in demos/expr/expr-impl.h.'>isasciicsym</a> (p-&gt;e[wlen]))
<a id='L170' name='L170'></a>      <strong class='reserved'>break</strong>;
<a id='L171' name='L171'></a>
<a id='L172' name='L172'></a>  <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("lookahead at: \"%.*s\" length %u, word %u\n",
<a id='L173' name='L173'></a>                 (<strong class='reserved'>int</strong>) p-&gt;elen, p-&gt;e, p-&gt;elen, wlen));
<a id='L174' name='L174'></a>
<a id='L175' name='L175'></a>  op_found = NULL;
<a id='L176' name='L176'></a>  oplen_found = 0;
<a id='L177' name='L177'></a>  <strong class='reserved'>for</strong> (op = p-&gt;<a href='../D/4296.html' title='Multiple defined in 2 places.'>table</a>; op-&gt;name != NULL; op++)
<a id='L178' name='L178'></a>    <em class='brace'>{</em>
<a id='L179' name='L179'></a>      <strong class='reserved'>if</strong> (op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> == <a href='../S/429.html#L78' title='Defined at 78 in demos/expr/expr.h.'>MPEXPR_TYPE_NEW_TABLE</a>)
<a id='L180' name='L180'></a>        <em class='brace'>{</em>
<a id='L181' name='L181'></a>          printf ("new\n");
<a id='L182' name='L182'></a>          op = (<strong class='reserved'>struct</strong> <a href='../S/429.html#L118' title='Defined at 118 in demos/expr/expr.h.'>mpexpr_operator_t</a> *) op-&gt;name - 1;
<a id='L183' name='L183'></a>          <strong class='reserved'>continue</strong>;
<a id='L184' name='L184'></a>        <em class='brace'>}</em>
<a id='L185' name='L185'></a>
<a id='L186' name='L186'></a>      oplen = strlen (op-&gt;name);
<a id='L187' name='L187'></a>      <strong class='reserved'>if</strong> (! ((<a href='../S/425.html#L140' title='Defined at 140 in demos/expr/expr.c.'>WHOLEWORD</a> (op) ? wlen == oplen : p-&gt;elen &gt;= oplen)
<a id='L188' name='L188'></a>             &amp;&amp; memcmp (p-&gt;e, op-&gt;name, oplen) == 0))
<a id='L189' name='L189'></a>        <strong class='reserved'>continue</strong>;
<a id='L190' name='L190'></a>
<a id='L191' name='L191'></a>      <em class='comment'>/* Shorter matches don't replace longer previous ones. */</em>
<a id='L192' name='L192'></a>      <strong class='reserved'>if</strong> (op_found &amp;&amp; oplen &lt; oplen_found)
<a id='L193' name='L193'></a>        <strong class='reserved'>continue</strong>;
<a id='L194' name='L194'></a>
<a id='L195' name='L195'></a>      <em class='comment'>/* On a match of equal length to a previous one, the old match isn't</em>
<a id='L196' name='L196'></a><em class='comment'>         replaced if it has the preferred prefix, and if it doesn't then</em>
<a id='L197' name='L197'></a><em class='comment'>         it's not replaced if the new one also doesn't.  */</em>
<a id='L198' name='L198'></a>      <strong class='reserved'>if</strong> (op_found &amp;&amp; oplen == oplen_found
<a id='L199' name='L199'></a>          &amp;&amp; ((op_found-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L69' title='Defined at 69 in demos/expr/expr.h.'>MPEXPR_TYPE_PREFIX</a>) == prefix
<a id='L200' name='L200'></a>              || (op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L69' title='Defined at 69 in demos/expr/expr.h.'>MPEXPR_TYPE_PREFIX</a>) != prefix))
<a id='L201' name='L201'></a>        <strong class='reserved'>continue</strong>;
<a id='L202' name='L202'></a>
<a id='L203' name='L203'></a>      <em class='comment'>/* This is now either the first match seen, or a longer than previous</em>
<a id='L204' name='L204'></a><em class='comment'>         match, or an equal to previous one but with a preferred prefix. */</em>
<a id='L205' name='L205'></a>      op_found = op;
<a id='L206' name='L206'></a>      oplen_found = oplen;
<a id='L207' name='L207'></a>    <em class='brace'>}</em>
<a id='L208' name='L208'></a>
<a id='L209' name='L209'></a>  <strong class='reserved'>if</strong> (op_found)
<a id='L210' name='L210'></a>    <em class='brace'>{</em>
<a id='L211' name='L211'></a>      p-&gt;e += oplen_found, p-&gt;elen -= oplen_found;
<a id='L212' name='L212'></a>
<a id='L213' name='L213'></a>      <strong class='reserved'>if</strong> (op_found-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> == <a href='../S/429.html#L80' title='Defined at 80 in demos/expr/expr.h.'>MPEXPR_TYPE_VARIABLE</a>)
<a id='L214' name='L214'></a>        <em class='brace'>{</em>
<a id='L215' name='L215'></a>          <strong class='reserved'>if</strong> (p-&gt;elen == 0)
<a id='L216' name='L216'></a>            <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("end of string expecting a variable",
<a id='L217' name='L217'></a>                   <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L218' name='L218'></a>          i = p-&gt;e[0] - 'a';
<a id='L219' name='L219'></a>          <strong class='reserved'>if</strong> (i &lt; 0 || i &gt;= <a href='../S/434.html#L86' title='Defined at 86 in demos/expr/expr-impl.h.'>MPEXPR_VARIABLES</a>)
<a id='L220' name='L220'></a>            <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("bad variable name", <a href='../S/429.html#L36' title='Defined at 36 in demos/expr/expr.h.'>MPEXPR_RESULT_BAD_VARIABLE</a>);
<a id='L221' name='L221'></a>          <strong class='reserved'>goto</strong> variable;
<a id='L222' name='L222'></a>        <em class='brace'>}</em>
<a id='L223' name='L223'></a>
<a id='L224' name='L224'></a>      <strong class='reserved'>if</strong> (op_found-&gt;precedence == 0)
<a id='L225' name='L225'></a>        <em class='brace'>{</em>
<a id='L226' name='L226'></a>          <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("lookahead function: %s\n", op_found-&gt;name));
<a id='L227' name='L227'></a>          p-&gt;token = <a href='../S/425.html#L129' title='Defined at 129 in demos/expr/expr.c.'>TOKEN_FUNCTION</a>;
<a id='L228' name='L228'></a>          p-&gt;token_op = op_found;
<a id='L229' name='L229'></a>          <strong class='reserved'>return</strong> 1;
<a id='L230' name='L230'></a>        <em class='brace'>}</em>
<a id='L231' name='L231'></a>      <strong class='reserved'>else</strong>
<a id='L232' name='L232'></a>        <em class='brace'>{</em>
<a id='L233' name='L233'></a>          <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("lookahead operator: %s\n", op_found-&gt;name));
<a id='L234' name='L234'></a>          p-&gt;token = <a href='../S/425.html#L128' title='Defined at 128 in demos/expr/expr.c.'>TOKEN_OPERATOR</a>;
<a id='L235' name='L235'></a>          p-&gt;token_op = op_found;
<a id='L236' name='L236'></a>          <strong class='reserved'>return</strong> 1;
<a id='L237' name='L237'></a>        <em class='brace'>}</em>
<a id='L238' name='L238'></a>    <em class='brace'>}</em>
<a id='L239' name='L239'></a>
<a id='L240' name='L240'></a>  oplen = (*p-&gt;mpX_number) (<a href='../S/425.html#L83' title='Defined at 83 in demos/expr/expr.c.'>SP</a>+1, p-&gt;e, p-&gt;elen, p-&gt;base);
<a id='L241' name='L241'></a>  <strong class='reserved'>if</strong> (oplen != 0)
<a id='L242' name='L242'></a>    <em class='brace'>{</em>
<a id='L243' name='L243'></a>      p-&gt;e += oplen, p-&gt;elen -= oplen;
<a id='L244' name='L244'></a>      p-&gt;token = <a href='../S/425.html#L127' title='Defined at 127 in demos/expr/expr.c.'>TOKEN_VALUE</a>;
<a id='L245' name='L245'></a>      <a href='../S/425.html#L105' title='Defined at 105 in demos/expr/expr.c.'>DATA_PUSH</a> ();
<a id='L246' name='L246'></a>      <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (<a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("lookahead number", <a href='../S/425.html#L83' title='Defined at 83 in demos/expr/expr.c.'>SP</a>));
<a id='L247' name='L247'></a>      <strong class='reserved'>return</strong> 1;
<a id='L248' name='L248'></a>    <em class='brace'>}</em>
<a id='L249' name='L249'></a>
<a id='L250' name='L250'></a>  <em class='comment'>/* Maybe an unprefixed one character variable */</em>
<a id='L251' name='L251'></a>  i = p-&gt;e[0] - 'a';
<a id='L252' name='L252'></a>  <strong class='reserved'>if</strong> (wlen == 1 &amp;&amp; i &gt;= 0 &amp;&amp; i &lt; <a href='../S/434.html#L86' title='Defined at 86 in demos/expr/expr-impl.h.'>MPEXPR_VARIABLES</a>)
<a id='L253' name='L253'></a>    <em class='brace'>{</em>
<a id='L254' name='L254'></a>    variable:
<a id='L255' name='L255'></a>      p-&gt;e++, p-&gt;elen--;
<a id='L256' name='L256'></a>      <strong class='reserved'>if</strong> (p-&gt;var[i] == NULL)
<a id='L257' name='L257'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("NULL variable", <a href='../S/429.html#L36' title='Defined at 36 in demos/expr/expr.h.'>MPEXPR_RESULT_BAD_VARIABLE</a>);
<a id='L258' name='L258'></a>      <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("lookahead variable: var[%d] = ", i);
<a id='L259' name='L259'></a>             <a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("", p-&gt;var[i]));
<a id='L260' name='L260'></a>      p-&gt;token = <a href='../S/425.html#L127' title='Defined at 127 in demos/expr/expr.c.'>TOKEN_VALUE</a>;
<a id='L261' name='L261'></a>      <a href='../S/425.html#L105' title='Defined at 105 in demos/expr/expr.c.'>DATA_PUSH</a> ();
<a id='L262' name='L262'></a>      (*p-&gt;mpX_set) (<a href='../S/425.html#L83' title='Defined at 83 in demos/expr/expr.c.'>SP</a>, p-&gt;var[i]);
<a id='L263' name='L263'></a>      <strong class='reserved'>return</strong> 1;
<a id='L264' name='L264'></a>    <em class='brace'>}</em>
<a id='L265' name='L265'></a>
<a id='L266' name='L266'></a>  <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("no token matched", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L267' name='L267'></a>
<a id='L268' name='L268'></a> done:
<a id='L269' name='L269'></a>  <strong class='reserved'>return</strong> 0;
<a id='L270' name='L270'></a><em class='brace'>}</em>
<a id='L271' name='L271'></a>
<a id='L272' name='L272'></a>
<a id='L273' name='L273'></a><em class='comment'>/* control stack current top element */</em>
<a id='L274' name='L274'></a><em class='sharp'>#define</em> <a href='../R/177.html' title='Multiple referred from 60 places.'>CP</a>   (p-&gt;control_stack + p-&gt;control_top)
<a id='L275' name='L275'></a>
<a id='L276' name='L276'></a><em class='comment'>/* make sure there's room for another control element above current top */</em>
<a id='L277' name='L277'></a><em class='sharp'>#define</em> <a href='../S/425.html#L294' title='Referred from 294 in demos/expr/expr.c.'>CONTROL_SPACE</a>()                                                    \
<a id='L278' name='L278'></a>  <strong class='reserved'>do</strong> <em class='brace'>{</em>                                                                     \
<a id='L279' name='L279'></a>    <strong class='reserved'>if</strong> (p-&gt;control_top + 1 &gt;= p-&gt;control_alloc)                            \
<a id='L280' name='L280'></a>      <em class='brace'>{</em>                                                                    \
<a id='L281' name='L281'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("grow control stack from %d\n", p-&gt;control_alloc)); \
<a id='L282' name='L282'></a>        <a href='../S/425.html#L74' title='Defined at 74 in demos/expr/expr.c.'>REALLOC</a> (p-&gt;control_stack, p-&gt;control_alloc, 20,                   \
<a id='L283' name='L283'></a>                 <strong class='reserved'>struct</strong> <a href='../S/434.html#L81' title='Defined at 81 in demos/expr/expr-impl.h.'>mpexpr_control_t</a>);                                 \
<a id='L284' name='L284'></a>      <em class='brace'>}</em>                                                                    \
<a id='L285' name='L285'></a>  <em class='brace'>}</em> <strong class='reserved'>while</strong> (0)
<a id='L286' name='L286'></a>
<a id='L287' name='L287'></a><em class='comment'>/* Push an operator on the control stack, claiming currently to have the</em>
<a id='L288' name='L288'></a><em class='comment'>   given number of args ready.  Local variable "op" is used in case opptr is</em>
<a id='L289' name='L289'></a><em class='comment'>   a reference through CP.  */</em>
<a id='L290' name='L290'></a><em class='sharp'>#define</em> <a href='../R/167.html' title='Multiple referred from 6 places.'>CONTROL_PUSH</a>(opptr,args)                        \
<a id='L291' name='L291'></a>  <strong class='reserved'>do</strong> <em class='brace'>{</em>                                                  \
<a id='L292' name='L292'></a>    <strong class='reserved'>const</strong> <strong class='reserved'>struct</strong> <a href='../S/429.html#L118' title='Defined at 118 in demos/expr/expr.h.'>mpexpr_operator_t</a> *op = opptr;         \
<a id='L293' name='L293'></a>    <strong class='reserved'>struct</strong> <a href='../S/434.html#L81' title='Defined at 81 in demos/expr/expr-impl.h.'>mpexpr_control_t</a> *cp;                        \
<a id='L294' name='L294'></a>    <a href='../S/425.html#L277' title='Defined at 277 in demos/expr/expr.c.'>CONTROL_SPACE</a> ();                                   \
<a id='L295' name='L295'></a>    p-&gt;control_top++;                                   \
<a id='L296' name='L296'></a>    <a href='../D/34.html' title='Multiple defined in 3 places.'>ASSERT</a> (p-&gt;control_top &lt; p-&gt;control_alloc);         \
<a id='L297' name='L297'></a>    cp = <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>;                                            \
<a id='L298' name='L298'></a>    cp-&gt;op = op;                                        \
<a id='L299' name='L299'></a>    cp-&gt;argcount = (args);                              \
<a id='L300' name='L300'></a>    <a href='../S/425.html#L311' title='Defined at 311 in demos/expr/expr.c.'>TRACE_CONTROL</a>("control stack push:");               \
<a id='L301' name='L301'></a>  <em class='brace'>}</em> <strong class='reserved'>while</strong> (0)
<a id='L302' name='L302'></a>
<a id='L303' name='L303'></a><em class='comment'>/* The special operator_done is never popped, so top&gt;=0 will hold. */</em>
<a id='L304' name='L304'></a><em class='sharp'>#define</em> <a href='../R/166.html' title='Multiple referred from 4 places.'>CONTROL_POP</a>()                           \
<a id='L305' name='L305'></a>  <strong class='reserved'>do</strong> <em class='brace'>{</em>                                          \
<a id='L306' name='L306'></a>    p-&gt;control_top--;                           \
<a id='L307' name='L307'></a>    <a href='../D/34.html' title='Multiple defined in 3 places.'>ASSERT</a> (p-&gt;control_top &gt;= 0);               \
<a id='L308' name='L308'></a>    <a href='../S/425.html#L311' title='Defined at 311 in demos/expr/expr.c.'>TRACE_CONTROL</a> ("control stack pop:");       \
<a id='L309' name='L309'></a>  <em class='brace'>}</em> <strong class='reserved'>while</strong> (0)
<a id='L310' name='L310'></a>
<a id='L311' name='L311'></a><em class='sharp'>#define</em> <a href='../R/1382.html' title='Multiple referred from 2 places.'>TRACE_CONTROL</a>(str)                              \
<a id='L312' name='L312'></a>  <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (<em class='brace'>{</em>                                              \
<a id='L313' name='L313'></a>    <strong class='reserved'>int</strong>  i;                                             \
<a id='L314' name='L314'></a>    printf ("%s depth %d:", str, p-&gt;control_top);       \
<a id='L315' name='L315'></a>    <strong class='reserved'>for</strong> (i = 0; i &lt;= p-&gt;control_top; i++)               \
<a id='L316' name='L316'></a>      printf (" \"%s\"(%d)",                            \
<a id='L317' name='L317'></a>              p-&gt;control_stack[i].op-&gt;name,             \
<a id='L318' name='L318'></a>              p-&gt;control_stack[i].argcount);            \
<a id='L319' name='L319'></a>    printf ("\n");                                      \
<a id='L320' name='L320'></a>  <em class='brace'>}</em>);
<a id='L321' name='L321'></a>
<a id='L322' name='L322'></a>
<a id='L323' name='L323'></a><em class='sharp'>#define</em> <a href='../R/576.html' title='Multiple referred from 5 places.'>LOOKAHEAD</a>(prefix)               \
<a id='L324' name='L324'></a>  <strong class='reserved'>do</strong> <em class='brace'>{</em>                                  \
<a id='L325' name='L325'></a>    <strong class='reserved'>if</strong> (! <a href='../S/425.html#L148' title='Defined at 148 in demos/expr/expr.c.'>lookahead</a> (p, prefix))        \
<a id='L326' name='L326'></a>      <strong class='reserved'>goto</strong> done;                        \
<a id='L327' name='L327'></a>  <em class='brace'>}</em> <strong class='reserved'>while</strong> (0)
<a id='L328' name='L328'></a>
<a id='L329' name='L329'></a><em class='sharp'>#define</em> <a href='../R/148.html' title='Multiple referred from 23 places.'>CHECK_UI</a>(n)                                                     \
<a id='L330' name='L330'></a>  <strong class='reserved'>do</strong> <em class='brace'>{</em>                                                                  \
<a id='L331' name='L331'></a>    <strong class='reserved'>if</strong> (! (*p-&gt;mpX_ulong_p) (n))                                        \
<a id='L332' name='L332'></a>      <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("operand doesn't fit ulong", <a href='../S/429.html#L39' title='Defined at 39 in demos/expr/expr.h.'>MPEXPR_RESULT_NOT_UI</a>);        \
<a id='L333' name='L333'></a>  <em class='brace'>}</em> <strong class='reserved'>while</strong> (0)
<a id='L334' name='L334'></a>
<a id='L335' name='L335'></a><em class='sharp'>#define</em> <a href='../R/120.html' title='Multiple referred from 3 places.'>CHECK_ARGCOUNT</a>(str,n)                                              \
<a id='L336' name='L336'></a>  <strong class='reserved'>do</strong> <em class='brace'>{</em>                                                                     \
<a id='L337' name='L337'></a>    <strong class='reserved'>if</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;argcount != (n))                                               \
<a id='L338' name='L338'></a>      <em class='brace'>{</em>                                                                    \
<a id='L339' name='L339'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("wrong number of arguments for %s, got %d want %d", \
<a id='L340' name='L340'></a>                       str, <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;argcount, n));                             \
<a id='L341' name='L341'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);                             \
<a id='L342' name='L342'></a>      <em class='brace'>}</em>                                                                    \
<a id='L343' name='L343'></a>  <em class='brace'>}</em> <strong class='reserved'>while</strong> (0)
<a id='L344' name='L344'></a>
<a id='L345' name='L345'></a>
<a id='L346' name='L346'></a><em class='comment'>/* There's two basic states here.  In both p-&gt;token is the next token.</em>
<a id='L347' name='L347'></a><em class='comment'></em>
<a id='L348' name='L348'></a><em class='comment'>   "another_expr" is when a whole expression should be parsed.  This means a</em>
<a id='L349' name='L349'></a><em class='comment'>   literal or variable value possibly followed by an operator, or a function</em>
<a id='L350' name='L350'></a><em class='comment'>   or prefix operator followed by a further whole expression.</em>
<a id='L351' name='L351'></a><em class='comment'></em>
<a id='L352' name='L352'></a><em class='comment'>   "another_operator" is when an expression has been parsed and its value is</em>
<a id='L353' name='L353'></a><em class='comment'>   on the top of the data stack (SP) and an optional further postfix or</em>
<a id='L354' name='L354'></a><em class='comment'>   infix operator should be parsed.</em>
<a id='L355' name='L355'></a><em class='comment'></em>
<a id='L356' name='L356'></a><em class='comment'>   In "another_operator" precedences determine whether to push the operator</em>
<a id='L357' name='L357'></a><em class='comment'>   onto the control stack, or instead go to "apply_control" to reduce the</em>
<a id='L358' name='L358'></a><em class='comment'>   operator currently on top of the control stack.</em>
<a id='L359' name='L359'></a><em class='comment'></em>
<a id='L360' name='L360'></a><em class='comment'>   When an operator has both a prefix and postfix/infix form, a LOOKAHEAD()</em>
<a id='L361' name='L361'></a><em class='comment'>   for "another_expr" will seek the prefix form, a LOOKAHEAD() for</em>
<a id='L362' name='L362'></a><em class='comment'>   "another_operator" will seek the postfix/infix form.  The grammar is</em>
<a id='L363' name='L363'></a><em class='comment'>   simple enough that the next state is known before reading the next token.</em>
<a id='L364' name='L364'></a><em class='comment'></em>
<a id='L365' name='L365'></a><em class='comment'>   Argument count checking guards against functions consuming the wrong</em>
<a id='L366' name='L366'></a><em class='comment'>   number of operands from the data stack.  The same checks are applied to</em>
<a id='L367' name='L367'></a><em class='comment'>   operators, but will always pass since a UNARY or BINARY will only ever</em>
<a id='L368' name='L368'></a><em class='comment'>   parse with the correct operands.  */</em>
<a id='L369' name='L369'></a>
<a id='L370' name='L370'></a><strong class='reserved'>int</strong>
<a id='L371' name='L371'></a><a href='../R/2511.html' title='Multiple referred from 4 places.'>mpexpr_evaluate</a> (<strong class='reserved'>struct</strong> <a href='../S/434.html#L88' title='Defined at 88 in demos/expr/expr-impl.h.'>mpexpr_parse_t</a> *p)
<a id='L372' name='L372'></a><em class='brace'>{</em>
<a id='L373' name='L373'></a>  <strong class='reserved'>void</strong> *(*allocate_func) (size_t);
<a id='L374' name='L374'></a>  <strong class='reserved'>void</strong> *(*reallocate_func) (<strong class='reserved'>void</strong> *, size_t, size_t);
<a id='L375' name='L375'></a>  <strong class='reserved'>void</strong> (*free_func) (<strong class='reserved'>void</strong> *, size_t);
<a id='L376' name='L376'></a>
<a id='L377' name='L377'></a>  <a href='../D/2744.html' title='Multiple defined in 2 places.'>mp_get_memory_functions</a> (&amp;allocate_func, &amp;reallocate_func, &amp;free_func);
<a id='L378' name='L378'></a>
<a id='L379' name='L379'></a>  <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("mpexpr_evaluate() base %d \"%.*s\"\n",
<a id='L380' name='L380'></a>                 p-&gt;base, (<strong class='reserved'>int</strong>) p-&gt;elen, p-&gt;e));
<a id='L381' name='L381'></a>
<a id='L382' name='L382'></a>  <em class='comment'>/* "done" is a special sentinel at the bottom of the control stack,</em>
<a id='L383' name='L383'></a><em class='comment'>     precedence -1 is lower than any normal operator.  */</em>
<a id='L384' name='L384'></a>  <em class='brace'>{</em>
<a id='L385' name='L385'></a>    <strong class='reserved'>static</strong> <strong class='reserved'>const</strong> <strong class='reserved'>struct</strong> <a href='../S/429.html#L118' title='Defined at 118 in demos/expr/expr.h.'>mpexpr_operator_t</a>  operator_done
<a id='L386' name='L386'></a>      = <em class='brace'>{</em> "DONE", NULL, <a href='../S/429.html#L79' title='Defined at 79 in demos/expr/expr.h.'>MPEXPR_TYPE_DONE</a>, -1 <em class='brace'>}</em>;
<a id='L387' name='L387'></a>
<a id='L388' name='L388'></a>    p-&gt;control_alloc = 20;
<a id='L389' name='L389'></a>    p-&gt;control_stack = <a href='../S/425.html#L50' title='Defined at 50 in demos/expr/expr.c.'>ALLOCATE_FUNC_TYPE</a> (p-&gt;control_alloc,
<a id='L390' name='L390'></a>                                           <strong class='reserved'>struct</strong> <a href='../S/434.html#L81' title='Defined at 81 in demos/expr/expr-impl.h.'>mpexpr_control_t</a>);
<a id='L391' name='L391'></a>    p-&gt;control_top = 0;
<a id='L392' name='L392'></a>    <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op = &amp;operator_done;
<a id='L393' name='L393'></a>    <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;argcount = 1;
<a id='L394' name='L394'></a>  <em class='brace'>}</em>
<a id='L395' name='L395'></a>
<a id='L396' name='L396'></a>  p-&gt;data_inited = 0;
<a id='L397' name='L397'></a>  p-&gt;data_alloc = 20;
<a id='L398' name='L398'></a>  p-&gt;data_stack = <a href='../S/425.html#L50' title='Defined at 50 in demos/expr/expr.c.'>ALLOCATE_FUNC_TYPE</a> (p-&gt;data_alloc, <strong class='reserved'>union</strong> <a href='../S/434.html#L46' title='Defined at 46 in demos/expr/expr-impl.h.'>mpX_t</a>);
<a id='L399' name='L399'></a>  p-&gt;data_top = -1;
<a id='L400' name='L400'></a>
<a id='L401' name='L401'></a>  p-&gt;error_code = <a href='../S/429.html#L35' title='Defined at 35 in demos/expr/expr.h.'>MPEXPR_RESULT_OK</a>;
<a id='L402' name='L402'></a>
<a id='L403' name='L403'></a>
<a id='L404' name='L404'></a> another_expr_lookahead:
<a id='L405' name='L405'></a>  <a href='../S/425.html#L323' title='Defined at 323 in demos/expr/expr.c.'>LOOKAHEAD</a> (<a href='../S/429.html#L69' title='Defined at 69 in demos/expr/expr.h.'>MPEXPR_TYPE_PREFIX</a>);
<a id='L406' name='L406'></a>  <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("another expr\n"));
<a id='L407' name='L407'></a>
<a id='L408' name='L408'></a>  <em class='comment'>/*another_expr:*/</em>
<a id='L409' name='L409'></a>  <strong class='reserved'>switch</strong> (p-&gt;token) <em class='brace'>{</em>
<a id='L410' name='L410'></a>  <strong class='reserved'>case</strong> <a href='../S/425.html#L127' title='Defined at 127 in demos/expr/expr.c.'>TOKEN_VALUE</a>:
<a id='L411' name='L411'></a>    <strong class='reserved'>goto</strong> another_operator_lookahead;
<a id='L412' name='L412'></a>
<a id='L413' name='L413'></a>  <strong class='reserved'>case</strong> <a href='../S/425.html#L128' title='Defined at 128 in demos/expr/expr.c.'>TOKEN_OPERATOR</a>:
<a id='L414' name='L414'></a>    <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("operator %s\n", p-&gt;token_op-&gt;name));
<a id='L415' name='L415'></a>    <strong class='reserved'>if</strong> (! (p-&gt;token_op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L69' title='Defined at 69 in demos/expr/expr.h.'>MPEXPR_TYPE_PREFIX</a>))
<a id='L416' name='L416'></a>      <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("expected a prefix operator", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L417' name='L417'></a>
<a id='L418' name='L418'></a>    <a href='../S/425.html#L290' title='Defined at 290 in demos/expr/expr.c.'>CONTROL_PUSH</a> (p-&gt;token_op, 1);
<a id='L419' name='L419'></a>    <strong class='reserved'>goto</strong> another_expr_lookahead;
<a id='L420' name='L420'></a>
<a id='L421' name='L421'></a>  <strong class='reserved'>case</strong> <a href='../S/425.html#L129' title='Defined at 129 in demos/expr/expr.c.'>TOKEN_FUNCTION</a>:
<a id='L422' name='L422'></a>    <a href='../S/425.html#L290' title='Defined at 290 in demos/expr/expr.c.'>CONTROL_PUSH</a> (p-&gt;token_op, 1);
<a id='L423' name='L423'></a>
<a id='L424' name='L424'></a>    <strong class='reserved'>if</strong> (p-&gt;token_op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L66' title='Defined at 66 in demos/expr/expr.h.'>MPEXPR_TYPE_CONSTANT</a>)
<a id='L425' name='L425'></a>      <strong class='reserved'>goto</strong> apply_control_lookahead;
<a id='L426' name='L426'></a>
<a id='L427' name='L427'></a>    <a href='../S/425.html#L323' title='Defined at 323 in demos/expr/expr.c.'>LOOKAHEAD</a> (<a href='../S/429.html#L69' title='Defined at 69 in demos/expr/expr.h.'>MPEXPR_TYPE_PREFIX</a>);
<a id='L428' name='L428'></a>    <strong class='reserved'>if</strong> (! (p-&gt;token == <a href='../S/425.html#L128' title='Defined at 128 in demos/expr/expr.c.'>TOKEN_OPERATOR</a>
<a id='L429' name='L429'></a>           &amp;&amp; p-&gt;token_op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> == <a href='../S/429.html#L83' title='Defined at 83 in demos/expr/expr.h.'>MPEXPR_TYPE_OPENPAREN</a>))
<a id='L430' name='L430'></a>      <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("expected open paren for function", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L431' name='L431'></a>
<a id='L432' name='L432'></a>    <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("open paren for function \"%s\"\n", <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;name));
<a id='L433' name='L433'></a>
<a id='L434' name='L434'></a>    <strong class='reserved'>if</strong> ((<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L44' title='Defined at 44 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_ARGCOUNT</a>) == <a href='../S/429.html#L43' title='Defined at 43 in demos/expr/expr.h.'>MPEXPR_TYPE_NARY</a>(0))
<a id='L435' name='L435'></a>      <em class='brace'>{</em>
<a id='L436' name='L436'></a>        <a href='../S/425.html#L323' title='Defined at 323 in demos/expr/expr.c.'>LOOKAHEAD</a> (0);
<a id='L437' name='L437'></a>        <strong class='reserved'>if</strong> (! (p-&gt;token == <a href='../S/425.html#L128' title='Defined at 128 in demos/expr/expr.c.'>TOKEN_OPERATOR</a>
<a id='L438' name='L438'></a>               &amp;&amp; p-&gt;token_op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> == <a href='../S/429.html#L82' title='Defined at 82 in demos/expr/expr.h.'>MPEXPR_TYPE_CLOSEPAREN</a>))
<a id='L439' name='L439'></a>          <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("expected close paren for 0ary function",
<a id='L440' name='L440'></a>                 <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L441' name='L441'></a>        <strong class='reserved'>goto</strong> apply_control_lookahead;
<a id='L442' name='L442'></a>      <em class='brace'>}</em>
<a id='L443' name='L443'></a>
<a id='L444' name='L444'></a>    <strong class='reserved'>goto</strong> another_expr_lookahead;
<a id='L445' name='L445'></a>  <em class='brace'>}</em>
<a id='L446' name='L446'></a>  <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("unrecognised start of expression", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L447' name='L447'></a>
<a id='L448' name='L448'></a>
<a id='L449' name='L449'></a> another_operator_lookahead:
<a id='L450' name='L450'></a>  <a href='../S/425.html#L323' title='Defined at 323 in demos/expr/expr.c.'>LOOKAHEAD</a> (0);
<a id='L451' name='L451'></a> another_operator:
<a id='L452' name='L452'></a>  <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("another operator maybe: %s\n", <a href='../S/425.html#L131' title='Defined at 131 in demos/expr/expr.c.'>TOKEN_NAME</a>(p-&gt;token)));
<a id='L453' name='L453'></a>
<a id='L454' name='L454'></a>  <strong class='reserved'>switch</strong> (p-&gt;token) <em class='brace'>{</em>
<a id='L455' name='L455'></a>  <strong class='reserved'>case</strong> <a href='../S/425.html#L126' title='Defined at 126 in demos/expr/expr.c.'>TOKEN_EOF</a>:
<a id='L456' name='L456'></a>    <strong class='reserved'>goto</strong> apply_control;
<a id='L457' name='L457'></a>
<a id='L458' name='L458'></a>  <strong class='reserved'>case</strong> <a href='../S/425.html#L128' title='Defined at 128 in demos/expr/expr.c.'>TOKEN_OPERATOR</a>:
<a id='L459' name='L459'></a>    <em class='comment'>/* The next operator is compared to the one on top of the control stack.</em>
<a id='L460' name='L460'></a><em class='comment'>       If the next is lower precedence, or the same precedence and not</em>
<a id='L461' name='L461'></a><em class='comment'>       right-associative, then reduce using the control stack and look at</em>
<a id='L462' name='L462'></a><em class='comment'>       the next operator again later.  */</em>
<a id='L463' name='L463'></a>
<a id='L464' name='L464'></a><em class='sharp'>#define</em> <a href='../S/425.html#L468' title='Referred from 468 in demos/expr/expr.c.'>PRECEDENCE_TEST_REDUCE</a>(tprec,cprec,ttype,ctype)                 \
<a id='L465' name='L465'></a>    ((tprec) &lt; (cprec)                                                  \
<a id='L466' name='L466'></a>     || ((tprec) == (cprec) &amp;&amp; ! ((ttype) &amp; <a href='../S/429.html#L72' title='Defined at 72 in demos/expr/expr.h.'>MPEXPR_TYPE_RIGHTASSOC</a>)))
<a id='L467' name='L467'></a>
<a id='L468' name='L468'></a>    <strong class='reserved'>if</strong> (<a href='../S/425.html#L464' title='Defined at 464 in demos/expr/expr.c.'>PRECEDENCE_TEST_REDUCE</a> (p-&gt;token_op-&gt;precedence, <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;precedence,
<a id='L469' name='L469'></a>                                p-&gt;token_op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>,       <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>))
<a id='L470' name='L470'></a>      <em class='brace'>{</em>
<a id='L471' name='L471'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("defer operator: %s (prec %d vs %d, type 0x%X)\n",
<a id='L472' name='L472'></a>                       p-&gt;token_op-&gt;name,
<a id='L473' name='L473'></a>                       p-&gt;token_op-&gt;precedence, <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;precedence,
<a id='L474' name='L474'></a>                       p-&gt;token_op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>));
<a id='L475' name='L475'></a>        <strong class='reserved'>goto</strong> apply_control;
<a id='L476' name='L476'></a>      <em class='brace'>}</em>
<a id='L477' name='L477'></a>
<a id='L478' name='L478'></a>    <em class='comment'>/* An argsep is a binary operator, but is never pushed on the control</em>
<a id='L479' name='L479'></a><em class='comment'>       stack, it just accumulates an extra argument for a function. */</em>
<a id='L480' name='L480'></a>    <strong class='reserved'>if</strong> (p-&gt;token_op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> == <a href='../S/429.html#L88' title='Defined at 88 in demos/expr/expr.h.'>MPEXPR_TYPE_ARGSEP</a>)
<a id='L481' name='L481'></a>      <em class='brace'>{</em>
<a id='L482' name='L482'></a>        <strong class='reserved'>if</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;precedence != 0)
<a id='L483' name='L483'></a>          <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("ARGSEP not in a function call", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L484' name='L484'></a>
<a id='L485' name='L485'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("argsep for function \"%s\"(%d)\n",
<a id='L486' name='L486'></a>                       <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;name, <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;argcount));
<a id='L487' name='L487'></a>
<a id='L488' name='L488'></a><em class='sharp'>#define</em> <a href='../S/425.html#L492' title='Referred from 492 in demos/expr/expr.c.'>IS_PAIRWISE</a>(<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>)                                               \
<a id='L489' name='L489'></a>        (((<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>) &amp; (<a href='../S/429.html#L44' title='Defined at 44 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_ARGCOUNT</a> | <a href='../S/429.html#L73' title='Defined at 73 in demos/expr/expr.h.'>MPEXPR_TYPE_PAIRWISE</a>))  \
<a id='L490' name='L490'></a>         == (<a href='../S/429.html#L47' title='Defined at 47 in demos/expr/expr.h.'>MPEXPR_TYPE_BINARY</a> | <a href='../S/429.html#L73' title='Defined at 73 in demos/expr/expr.h.'>MPEXPR_TYPE_PAIRWISE</a>))
<a id='L491' name='L491'></a>
<a id='L492' name='L492'></a>        <strong class='reserved'>if</strong> (<a href='../S/425.html#L488' title='Defined at 488 in demos/expr/expr.c.'>IS_PAIRWISE</a> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>) &amp;&amp; <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;argcount &gt;= 2)
<a id='L493' name='L493'></a>          <em class='brace'>{</em>
<a id='L494' name='L494'></a>            <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("    will reduce pairwise now\n"));
<a id='L495' name='L495'></a>            <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;argcount--;
<a id='L496' name='L496'></a>            <a href='../S/425.html#L290' title='Defined at 290 in demos/expr/expr.c.'>CONTROL_PUSH</a> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op, 2);
<a id='L497' name='L497'></a>            <strong class='reserved'>goto</strong> apply_control;
<a id='L498' name='L498'></a>          <em class='brace'>}</em>
<a id='L499' name='L499'></a>
<a id='L500' name='L500'></a>        <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;argcount++;
<a id='L501' name='L501'></a>        <strong class='reserved'>goto</strong> another_expr_lookahead;
<a id='L502' name='L502'></a>      <em class='brace'>}</em>
<a id='L503' name='L503'></a>
<a id='L504' name='L504'></a>    <strong class='reserved'>switch</strong> (p-&gt;token_op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L44' title='Defined at 44 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_ARGCOUNT</a>) <em class='brace'>{</em>
<a id='L505' name='L505'></a>    <strong class='reserved'>case</strong> <a href='../S/429.html#L43' title='Defined at 43 in demos/expr/expr.h.'>MPEXPR_TYPE_NARY</a>(1):
<a id='L506' name='L506'></a>      <em class='comment'>/* Postfix unary operators can always be applied immediately.  The</em>
<a id='L507' name='L507'></a><em class='comment'>         easiest way to do this is just push it on the control stack and go</em>
<a id='L508' name='L508'></a><em class='comment'>         to the normal control stack reduction code. */</em>
<a id='L509' name='L509'></a>
<a id='L510' name='L510'></a>      <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("postfix unary operator: %s\n", p-&gt;token_op-&gt;name));
<a id='L511' name='L511'></a>      <strong class='reserved'>if</strong> (p-&gt;token_op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L69' title='Defined at 69 in demos/expr/expr.h.'>MPEXPR_TYPE_PREFIX</a>)
<a id='L512' name='L512'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("prefix unary operator used postfix",
<a id='L513' name='L513'></a>               <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L514' name='L514'></a>      <a href='../S/425.html#L290' title='Defined at 290 in demos/expr/expr.c.'>CONTROL_PUSH</a> (p-&gt;token_op, 1);
<a id='L515' name='L515'></a>      <strong class='reserved'>goto</strong> apply_control_lookahead;
<a id='L516' name='L516'></a>
<a id='L517' name='L517'></a>    <strong class='reserved'>case</strong> <a href='../S/429.html#L43' title='Defined at 43 in demos/expr/expr.h.'>MPEXPR_TYPE_NARY</a>(2):
<a id='L518' name='L518'></a>      <a href='../S/425.html#L290' title='Defined at 290 in demos/expr/expr.c.'>CONTROL_PUSH</a> (p-&gt;token_op, 2);
<a id='L519' name='L519'></a>      <strong class='reserved'>goto</strong> another_expr_lookahead;
<a id='L520' name='L520'></a>
<a id='L521' name='L521'></a>    <strong class='reserved'>case</strong> <a href='../S/429.html#L43' title='Defined at 43 in demos/expr/expr.h.'>MPEXPR_TYPE_NARY</a>(3):
<a id='L522' name='L522'></a>      <a href='../S/425.html#L290' title='Defined at 290 in demos/expr/expr.c.'>CONTROL_PUSH</a> (p-&gt;token_op, 1);
<a id='L523' name='L523'></a>      <strong class='reserved'>goto</strong> another_expr_lookahead;
<a id='L524' name='L524'></a>    <em class='brace'>}</em>
<a id='L525' name='L525'></a>
<a id='L526' name='L526'></a>    <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("unrecognised operator \"%s\" type: 0x%X",
<a id='L527' name='L527'></a>                   <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;name, <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>));
<a id='L528' name='L528'></a>    <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L529' name='L529'></a>    <strong class='reserved'>break</strong>;
<a id='L530' name='L530'></a>
<a id='L531' name='L531'></a>  <strong class='reserved'>default</strong>:
<a id='L532' name='L532'></a>    <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("expecting an operator, got token %d", p-&gt;token));
<a id='L533' name='L533'></a>    <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L534' name='L534'></a>  <em class='brace'>}</em>
<a id='L535' name='L535'></a>
<a id='L536' name='L536'></a>
<a id='L537' name='L537'></a> apply_control_lookahead:
<a id='L538' name='L538'></a>  <a href='../S/425.html#L323' title='Defined at 323 in demos/expr/expr.c.'>LOOKAHEAD</a> (0);
<a id='L539' name='L539'></a> apply_control:
<a id='L540' name='L540'></a>  <em class='comment'>/* Apply the top element CP of the control stack.  Data values are SP,</em>
<a id='L541' name='L541'></a><em class='comment'>     SP-1, etc.  Result is left as stack top SP after popping consumed</em>
<a id='L542' name='L542'></a><em class='comment'>     values.</em>
<a id='L543' name='L543'></a><em class='comment'></em>
<a id='L544' name='L544'></a><em class='comment'>     The use of sp as a duplicate of SP will help compilers that can't</em>
<a id='L545' name='L545'></a><em class='comment'>     otherwise recognise the various uses of SP as common subexpressions.  */</em>
<a id='L546' name='L546'></a>
<a id='L547' name='L547'></a>  <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("apply control: nested %d, \"%s\" 0x%X, %d args\n",
<a id='L548' name='L548'></a>                 p-&gt;control_top, <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;name, <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>, <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;argcount));
<a id='L549' name='L549'></a>
<a id='L550' name='L550'></a>  <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("apply 0x%X-ary\n",
<a id='L551' name='L551'></a>                 <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L44' title='Defined at 44 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_ARGCOUNT</a>));
<a id='L552' name='L552'></a>  <strong class='reserved'>switch</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L44' title='Defined at 44 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_ARGCOUNT</a>) <em class='brace'>{</em>
<a id='L553' name='L553'></a>  <strong class='reserved'>case</strong> <a href='../S/429.html#L43' title='Defined at 43 in demos/expr/expr.h.'>MPEXPR_TYPE_NARY</a>(0):
<a id='L554' name='L554'></a>    <em class='brace'>{</em>
<a id='L555' name='L555'></a>      <a href='../S/434.html#L52' title='Defined at 52 in demos/expr/expr-impl.h.'>mpX_ptr</a>  sp;
<a id='L556' name='L556'></a>      <a href='../S/425.html#L87' title='Defined at 87 in demos/expr/expr.c.'>DATA_SPACE</a> ();
<a id='L557' name='L557'></a>      <a href='../S/425.html#L105' title='Defined at 105 in demos/expr/expr.c.'>DATA_PUSH</a> ();
<a id='L558' name='L558'></a>      sp = <a href='../S/425.html#L83' title='Defined at 83 in demos/expr/expr.c.'>SP</a>;
<a id='L559' name='L559'></a>      <strong class='reserved'>switch</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L53' title='Defined at 53 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_ARGSTYLE</a>) <em class='brace'>{</em>
<a id='L560' name='L560'></a>      <strong class='reserved'>case</strong> 0:
<a id='L561' name='L561'></a>        (* (mpexpr_fun_0ary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp);
<a id='L562' name='L562'></a>        <strong class='reserved'>break</strong>;
<a id='L563' name='L563'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L52' title='Defined at 52 in demos/expr/expr.h.'>MPEXPR_TYPE_RESULT_INT</a>:
<a id='L564' name='L564'></a>        (*p-&gt;mpX_set_si) (sp, (<strong class='reserved'>long</strong>) (* (mpexpr_fun_i_0ary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) ());
<a id='L565' name='L565'></a>        <strong class='reserved'>break</strong>;
<a id='L566' name='L566'></a>      <strong class='reserved'>default</strong>:
<a id='L567' name='L567'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("unrecognised 0ary argument calling style",
<a id='L568' name='L568'></a>               <a href='../S/429.html#L37' title='Defined at 37 in demos/expr/expr.h.'>MPEXPR_RESULT_BAD_TABLE</a>);
<a id='L569' name='L569'></a>      <em class='brace'>}</em>
<a id='L570' name='L570'></a>    <em class='brace'>}</em>
<a id='L571' name='L571'></a>    <strong class='reserved'>break</strong>;
<a id='L572' name='L572'></a>
<a id='L573' name='L573'></a>  <strong class='reserved'>case</strong> <a href='../S/429.html#L43' title='Defined at 43 in demos/expr/expr.h.'>MPEXPR_TYPE_NARY</a>(1):
<a id='L574' name='L574'></a>    <em class='brace'>{</em>
<a id='L575' name='L575'></a>      <a href='../S/434.html#L52' title='Defined at 52 in demos/expr/expr-impl.h.'>mpX_ptr</a>  sp = <a href='../S/425.html#L83' title='Defined at 83 in demos/expr/expr.c.'>SP</a>;
<a id='L576' name='L576'></a>      <a href='../S/425.html#L335' title='Defined at 335 in demos/expr/expr.c.'>CHECK_ARGCOUNT</a> ("unary", 1);
<a id='L577' name='L577'></a>      <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (<a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("before", sp));
<a id='L578' name='L578'></a>
<a id='L579' name='L579'></a>      <strong class='reserved'>switch</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>) <em class='brace'>{</em>
<a id='L580' name='L580'></a>      <strong class='reserved'>case</strong> 0:
<a id='L581' name='L581'></a>        <em class='comment'>/* not a special */</em>
<a id='L582' name='L582'></a>        <strong class='reserved'>break</strong>;
<a id='L583' name='L583'></a>
<a id='L584' name='L584'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L79' title='Defined at 79 in demos/expr/expr.h.'>MPEXPR_TYPE_DONE</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>:
<a id='L585' name='L585'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("special done\n"));
<a id='L586' name='L586'></a>        <strong class='reserved'>goto</strong> done;
<a id='L587' name='L587'></a>
<a id='L588' name='L588'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L81' title='Defined at 81 in demos/expr/expr.h.'>MPEXPR_TYPE_LOGICAL_NOT</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>:
<a id='L589' name='L589'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("special logical not\n"));
<a id='L590' name='L590'></a>        (*p-&gt;mpX_set_si)
<a id='L591' name='L591'></a>          (sp, (<strong class='reserved'>long</strong>) ((* (mpexpr_fun_i_unary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp) == 0));
<a id='L592' name='L592'></a>        <strong class='reserved'>goto</strong> apply_control_done;
<a id='L593' name='L593'></a>
<a id='L594' name='L594'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L82' title='Defined at 82 in demos/expr/expr.h.'>MPEXPR_TYPE_CLOSEPAREN</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>:
<a id='L595' name='L595'></a>        <a href='../S/425.html#L304' title='Defined at 304 in demos/expr/expr.c.'>CONTROL_POP</a> ();
<a id='L596' name='L596'></a>        <strong class='reserved'>if</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> == <a href='../S/429.html#L83' title='Defined at 83 in demos/expr/expr.h.'>MPEXPR_TYPE_OPENPAREN</a>)
<a id='L597' name='L597'></a>          <em class='brace'>{</em>
<a id='L598' name='L598'></a>            <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("close paren matching open paren\n"));
<a id='L599' name='L599'></a>            <a href='../S/425.html#L304' title='Defined at 304 in demos/expr/expr.c.'>CONTROL_POP</a> ();
<a id='L600' name='L600'></a>            <strong class='reserved'>goto</strong> another_operator;
<a id='L601' name='L601'></a>          <em class='brace'>}</em>
<a id='L602' name='L602'></a>        <strong class='reserved'>if</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;precedence == 0)
<a id='L603' name='L603'></a>          <em class='brace'>{</em>
<a id='L604' name='L604'></a>            <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("close paren for function\n"));
<a id='L605' name='L605'></a>            <strong class='reserved'>goto</strong> apply_control;
<a id='L606' name='L606'></a>          <em class='brace'>}</em>
<a id='L607' name='L607'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("unexpected close paren", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L608' name='L608'></a>
<a id='L609' name='L609'></a>      <strong class='reserved'>default</strong>:
<a id='L610' name='L610'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("unrecognised special unary operator 0x%X",
<a id='L611' name='L611'></a>                       <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>));
<a id='L612' name='L612'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("", <a href='../S/429.html#L37' title='Defined at 37 in demos/expr/expr.h.'>MPEXPR_RESULT_BAD_TABLE</a>);
<a id='L613' name='L613'></a>      <em class='brace'>}</em>
<a id='L614' name='L614'></a>
<a id='L615' name='L615'></a>      <strong class='reserved'>switch</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L53' title='Defined at 53 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_ARGSTYLE</a>) <em class='brace'>{</em>
<a id='L616' name='L616'></a>      <strong class='reserved'>case</strong> 0:
<a id='L617' name='L617'></a>        (* (mpexpr_fun_unary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp, sp);
<a id='L618' name='L618'></a>        <strong class='reserved'>break</strong>;
<a id='L619' name='L619'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L51' title='Defined at 51 in demos/expr/expr.h.'>MPEXPR_TYPE_LAST_UI</a>:
<a id='L620' name='L620'></a>        <a href='../D/153.html' title='Multiple defined in 4 places.'>CHECK_UI</a> (sp);
<a id='L621' name='L621'></a>        (* (mpexpr_fun_unary_ui_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun)
<a id='L622' name='L622'></a>          (sp, (*p-&gt;mpX_get_ui) (sp));
<a id='L623' name='L623'></a>        <strong class='reserved'>break</strong>;
<a id='L624' name='L624'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L52' title='Defined at 52 in demos/expr/expr.h.'>MPEXPR_TYPE_RESULT_INT</a>:
<a id='L625' name='L625'></a>        (*p-&gt;mpX_set_si)
<a id='L626' name='L626'></a>          (sp, (<strong class='reserved'>long</strong>) (* (mpexpr_fun_i_unary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp));
<a id='L627' name='L627'></a>        <strong class='reserved'>break</strong>;
<a id='L628' name='L628'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L52' title='Defined at 52 in demos/expr/expr.h.'>MPEXPR_TYPE_RESULT_INT</a> | <a href='../S/429.html#L51' title='Defined at 51 in demos/expr/expr.h.'>MPEXPR_TYPE_LAST_UI</a>:
<a id='L629' name='L629'></a>        <a href='../D/153.html' title='Multiple defined in 4 places.'>CHECK_UI</a> (sp);
<a id='L630' name='L630'></a>        (*p-&gt;mpX_set_si)
<a id='L631' name='L631'></a>          (sp,
<a id='L632' name='L632'></a>           (<strong class='reserved'>long</strong>) (* (mpexpr_fun_i_unary_ui_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun)
<a id='L633' name='L633'></a>           ((*p-&gt;mpX_get_ui) (sp)));
<a id='L634' name='L634'></a>        <strong class='reserved'>break</strong>;
<a id='L635' name='L635'></a>      <strong class='reserved'>default</strong>:
<a id='L636' name='L636'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("unrecognised unary argument calling style",
<a id='L637' name='L637'></a>               <a href='../S/429.html#L37' title='Defined at 37 in demos/expr/expr.h.'>MPEXPR_RESULT_BAD_TABLE</a>);
<a id='L638' name='L638'></a>      <em class='brace'>}</em>
<a id='L639' name='L639'></a>    <em class='brace'>}</em>
<a id='L640' name='L640'></a>    <strong class='reserved'>break</strong>;
<a id='L641' name='L641'></a>
<a id='L642' name='L642'></a>  <strong class='reserved'>case</strong> <a href='../S/429.html#L43' title='Defined at 43 in demos/expr/expr.h.'>MPEXPR_TYPE_NARY</a>(2):
<a id='L643' name='L643'></a>    <em class='brace'>{</em>
<a id='L644' name='L644'></a>      <a href='../S/434.html#L52' title='Defined at 52 in demos/expr/expr-impl.h.'>mpX_ptr</a>  sp;
<a id='L645' name='L645'></a>
<a id='L646' name='L646'></a>      <em class='comment'>/* pairwise functions are allowed to have just one argument */</em>
<a id='L647' name='L647'></a>      <strong class='reserved'>if</strong> ((<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L73' title='Defined at 73 in demos/expr/expr.h.'>MPEXPR_TYPE_PAIRWISE</a>)
<a id='L648' name='L648'></a>          &amp;&amp; <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;precedence == 0
<a id='L649' name='L649'></a>          &amp;&amp; <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;argcount == 1)
<a id='L650' name='L650'></a>        <strong class='reserved'>goto</strong> apply_control_done;
<a id='L651' name='L651'></a>
<a id='L652' name='L652'></a>      <a href='../S/425.html#L335' title='Defined at 335 in demos/expr/expr.c.'>CHECK_ARGCOUNT</a> ("binary", 2);
<a id='L653' name='L653'></a>      <a href='../S/425.html#L113' title='Defined at 113 in demos/expr/expr.c.'>DATA_POP</a> (1);
<a id='L654' name='L654'></a>      sp = <a href='../S/425.html#L83' title='Defined at 83 in demos/expr/expr.c.'>SP</a>;
<a id='L655' name='L655'></a>      <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (<a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("lhs", sp);
<a id='L656' name='L656'></a>             <a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("rhs", sp+1));
<a id='L657' name='L657'></a>
<a id='L658' name='L658'></a>      <strong class='reserved'>if</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L93' title='Defined at 93 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_CMP</a>)
<a id='L659' name='L659'></a>        <em class='brace'>{</em>
<a id='L660' name='L660'></a>          <strong class='reserved'>int</strong>  <a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> = <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>;
<a id='L661' name='L661'></a>          <strong class='reserved'>int</strong>  cmp = (* (mpexpr_fun_i_binary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun)
<a id='L662' name='L662'></a>            (sp, sp+1);
<a id='L663' name='L663'></a>          (*p-&gt;mpX_set_si)
<a id='L664' name='L664'></a>            (sp,
<a id='L665' name='L665'></a>             (<strong class='reserved'>long</strong>)
<a id='L666' name='L666'></a>             ((  (cmp  &lt; 0) &amp; ((<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L94' title='Defined at 94 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_CMP_LT</a>) != 0))
<a id='L667' name='L667'></a>              | ((cmp == 0) &amp; ((<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L95' title='Defined at 95 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_CMP_EQ</a>) != 0))
<a id='L668' name='L668'></a>              | ((cmp  &gt; 0) &amp; ((<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L96' title='Defined at 96 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_CMP_GT</a>) != 0))));
<a id='L669' name='L669'></a>          <strong class='reserved'>goto</strong> apply_control_done;
<a id='L670' name='L670'></a>        <em class='brace'>}</em>
<a id='L671' name='L671'></a>
<a id='L672' name='L672'></a>      <strong class='reserved'>switch</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>) <em class='brace'>{</em>
<a id='L673' name='L673'></a>      <strong class='reserved'>case</strong> 0:
<a id='L674' name='L674'></a>        <em class='comment'>/* not a special */</em>
<a id='L675' name='L675'></a>        <strong class='reserved'>break</strong>;
<a id='L676' name='L676'></a>
<a id='L677' name='L677'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L89' title='Defined at 89 in demos/expr/expr.h.'>MPEXPR_TYPE_QUESTION</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>:
<a id='L678' name='L678'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("'?' without ':'", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L679' name='L679'></a>
<a id='L680' name='L680'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L90' title='Defined at 90 in demos/expr/expr.h.'>MPEXPR_TYPE_COLON</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>:
<a id='L681' name='L681'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("special colon\n"));
<a id='L682' name='L682'></a>        <a href='../S/425.html#L304' title='Defined at 304 in demos/expr/expr.c.'>CONTROL_POP</a> ();
<a id='L683' name='L683'></a>        <strong class='reserved'>if</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> != <a href='../S/429.html#L89' title='Defined at 89 in demos/expr/expr.h.'>MPEXPR_TYPE_QUESTION</a>)
<a id='L684' name='L684'></a>          <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("':' without '?'", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L685' name='L685'></a>
<a id='L686' name='L686'></a>        <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;argcount--;
<a id='L687' name='L687'></a>        <a href='../S/425.html#L113' title='Defined at 113 in demos/expr/expr.c.'>DATA_POP</a> (1);
<a id='L688' name='L688'></a>        sp--;
<a id='L689' name='L689'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (<a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("query", sp);
<a id='L690' name='L690'></a>               <a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("true",  sp+1);
<a id='L691' name='L691'></a>               <a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("false", sp+2));
<a id='L692' name='L692'></a>        (*p-&gt;mpX_set)
<a id='L693' name='L693'></a>          (sp, (* (mpexpr_fun_i_unary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp)
<a id='L694' name='L694'></a>           ? sp+1 : sp+2);
<a id='L695' name='L695'></a>        <strong class='reserved'>goto</strong> apply_control_done;
<a id='L696' name='L696'></a>
<a id='L697' name='L697'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L86' title='Defined at 86 in demos/expr/expr.h.'>MPEXPR_TYPE_LOGICAL_AND</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>:
<a id='L698' name='L698'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("special logical and\n"));
<a id='L699' name='L699'></a>        (*p-&gt;mpX_set_si)
<a id='L700' name='L700'></a>          (sp,
<a id='L701' name='L701'></a>           (<strong class='reserved'>long</strong>)
<a id='L702' name='L702'></a>           ((* (mpexpr_fun_i_unary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp)
<a id='L703' name='L703'></a>            &amp;&amp; (* (mpexpr_fun_i_unary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp+1)));
<a id='L704' name='L704'></a>        <strong class='reserved'>goto</strong> apply_control_done;
<a id='L705' name='L705'></a>
<a id='L706' name='L706'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L87' title='Defined at 87 in demos/expr/expr.h.'>MPEXPR_TYPE_LOGICAL_OR</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>:
<a id='L707' name='L707'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("special logical and\n"));
<a id='L708' name='L708'></a>        (*p-&gt;mpX_set_si)
<a id='L709' name='L709'></a>          (sp,
<a id='L710' name='L710'></a>           (<strong class='reserved'>long</strong>)
<a id='L711' name='L711'></a>           ((* (mpexpr_fun_i_unary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp)
<a id='L712' name='L712'></a>            || (* (mpexpr_fun_i_unary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp+1)));
<a id='L713' name='L713'></a>        <strong class='reserved'>goto</strong> apply_control_done;
<a id='L714' name='L714'></a>
<a id='L715' name='L715'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L91' title='Defined at 91 in demos/expr/expr.h.'>MPEXPR_TYPE_MAX</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>:
<a id='L716' name='L716'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("special max\n"));
<a id='L717' name='L717'></a>        <strong class='reserved'>if</strong> ((* (mpexpr_fun_i_binary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp, sp+1) &lt; 0)
<a id='L718' name='L718'></a>          (*p-&gt;mpX_swap) (sp, sp+1);
<a id='L719' name='L719'></a>        <strong class='reserved'>goto</strong> apply_control_done;
<a id='L720' name='L720'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L92' title='Defined at 92 in demos/expr/expr.h.'>MPEXPR_TYPE_MIN</a> &amp; <a href='../S/429.html#L75' title='Defined at 75 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_SPECIAL</a>:
<a id='L721' name='L721'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("special min\n"));
<a id='L722' name='L722'></a>        <strong class='reserved'>if</strong> ((* (mpexpr_fun_i_binary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp, sp+1) &gt; 0)
<a id='L723' name='L723'></a>          (*p-&gt;mpX_swap) (sp, sp+1);
<a id='L724' name='L724'></a>        <strong class='reserved'>goto</strong> apply_control_done;
<a id='L725' name='L725'></a>
<a id='L726' name='L726'></a>      <strong class='reserved'>default</strong>:
<a id='L727' name='L727'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("unrecognised special binary operator",
<a id='L728' name='L728'></a>               <a href='../S/429.html#L37' title='Defined at 37 in demos/expr/expr.h.'>MPEXPR_RESULT_BAD_TABLE</a>);
<a id='L729' name='L729'></a>      <em class='brace'>}</em>
<a id='L730' name='L730'></a>
<a id='L731' name='L731'></a>      <strong class='reserved'>switch</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L53' title='Defined at 53 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_ARGSTYLE</a>) <em class='brace'>{</em>
<a id='L732' name='L732'></a>      <strong class='reserved'>case</strong> 0:
<a id='L733' name='L733'></a>        (* (mpexpr_fun_binary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp, sp, sp+1);
<a id='L734' name='L734'></a>        <strong class='reserved'>break</strong>;
<a id='L735' name='L735'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L51' title='Defined at 51 in demos/expr/expr.h.'>MPEXPR_TYPE_LAST_UI</a>:
<a id='L736' name='L736'></a>        <a href='../D/153.html' title='Multiple defined in 4 places.'>CHECK_UI</a> (sp+1);
<a id='L737' name='L737'></a>        (* (mpexpr_fun_binary_ui_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun)
<a id='L738' name='L738'></a>          (sp, sp, (*p-&gt;mpX_get_ui) (sp+1));
<a id='L739' name='L739'></a>        <strong class='reserved'>break</strong>;
<a id='L740' name='L740'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L52' title='Defined at 52 in demos/expr/expr.h.'>MPEXPR_TYPE_RESULT_INT</a>:
<a id='L741' name='L741'></a>        (*p-&gt;mpX_set_si)
<a id='L742' name='L742'></a>          (sp,
<a id='L743' name='L743'></a>           (<strong class='reserved'>long</strong>) (* (mpexpr_fun_i_binary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp, sp+1));
<a id='L744' name='L744'></a>        <strong class='reserved'>break</strong>;
<a id='L745' name='L745'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L51' title='Defined at 51 in demos/expr/expr.h.'>MPEXPR_TYPE_LAST_UI</a> | <a href='../S/429.html#L52' title='Defined at 52 in demos/expr/expr.h.'>MPEXPR_TYPE_RESULT_INT</a>:
<a id='L746' name='L746'></a>        <a href='../D/153.html' title='Multiple defined in 4 places.'>CHECK_UI</a> (sp+1);
<a id='L747' name='L747'></a>        (*p-&gt;mpX_set_si)
<a id='L748' name='L748'></a>          (sp,
<a id='L749' name='L749'></a>           (<strong class='reserved'>long</strong>) (* (mpexpr_fun_i_binary_ui_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun)
<a id='L750' name='L750'></a>           (sp, (*p-&gt;mpX_get_ui) (sp+1)));
<a id='L751' name='L751'></a>        <strong class='reserved'>break</strong>;
<a id='L752' name='L752'></a>      <strong class='reserved'>default</strong>:
<a id='L753' name='L753'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("unrecognised binary argument calling style",
<a id='L754' name='L754'></a>               <a href='../S/429.html#L37' title='Defined at 37 in demos/expr/expr.h.'>MPEXPR_RESULT_BAD_TABLE</a>);
<a id='L755' name='L755'></a>      <em class='brace'>}</em>
<a id='L756' name='L756'></a>    <em class='brace'>}</em>
<a id='L757' name='L757'></a>    <strong class='reserved'>break</strong>;
<a id='L758' name='L758'></a>
<a id='L759' name='L759'></a>  <strong class='reserved'>case</strong> <a href='../S/429.html#L43' title='Defined at 43 in demos/expr/expr.h.'>MPEXPR_TYPE_NARY</a>(3):
<a id='L760' name='L760'></a>    <em class='brace'>{</em>
<a id='L761' name='L761'></a>      <a href='../S/434.html#L52' title='Defined at 52 in demos/expr/expr-impl.h.'>mpX_ptr</a>  sp;
<a id='L762' name='L762'></a>
<a id='L763' name='L763'></a>      <a href='../S/425.html#L335' title='Defined at 335 in demos/expr/expr.c.'>CHECK_ARGCOUNT</a> ("ternary", 3);
<a id='L764' name='L764'></a>      <a href='../S/425.html#L113' title='Defined at 113 in demos/expr/expr.c.'>DATA_POP</a> (2);
<a id='L765' name='L765'></a>      sp = <a href='../S/425.html#L83' title='Defined at 83 in demos/expr/expr.c.'>SP</a>;
<a id='L766' name='L766'></a>      <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (<a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("arg1", sp);
<a id='L767' name='L767'></a>             <a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("arg2", sp+1);
<a id='L768' name='L768'></a>             <a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("arg3", sp+1));
<a id='L769' name='L769'></a>
<a id='L770' name='L770'></a>      <strong class='reserved'>switch</strong> (<a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a> &amp; <a href='../S/429.html#L53' title='Defined at 53 in demos/expr/expr.h.'>MPEXPR_TYPE_MASK_ARGSTYLE</a>) <em class='brace'>{</em>
<a id='L771' name='L771'></a>      <strong class='reserved'>case</strong> 0:
<a id='L772' name='L772'></a>        (* (mpexpr_fun_ternary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun) (sp, sp, sp+1, sp+2);
<a id='L773' name='L773'></a>        <strong class='reserved'>break</strong>;
<a id='L774' name='L774'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L51' title='Defined at 51 in demos/expr/expr.h.'>MPEXPR_TYPE_LAST_UI</a>:
<a id='L775' name='L775'></a>        <a href='../D/153.html' title='Multiple defined in 4 places.'>CHECK_UI</a> (sp+2);
<a id='L776' name='L776'></a>        (* (mpexpr_fun_ternary_ui_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun)
<a id='L777' name='L777'></a>          (sp, sp, sp+1, (*p-&gt;mpX_get_ui) (sp+2));
<a id='L778' name='L778'></a>        <strong class='reserved'>break</strong>;
<a id='L779' name='L779'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L52' title='Defined at 52 in demos/expr/expr.h.'>MPEXPR_TYPE_RESULT_INT</a>:
<a id='L780' name='L780'></a>        (*p-&gt;mpX_set_si)
<a id='L781' name='L781'></a>          (sp,
<a id='L782' name='L782'></a>           (<strong class='reserved'>long</strong>) (* (mpexpr_fun_i_ternary_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun)
<a id='L783' name='L783'></a>           (sp, sp+1, sp+2));
<a id='L784' name='L784'></a>        <strong class='reserved'>break</strong>;
<a id='L785' name='L785'></a>      <strong class='reserved'>case</strong> <a href='../S/429.html#L51' title='Defined at 51 in demos/expr/expr.h.'>MPEXPR_TYPE_LAST_UI</a> | <a href='../S/429.html#L52' title='Defined at 52 in demos/expr/expr.h.'>MPEXPR_TYPE_RESULT_INT</a>:
<a id='L786' name='L786'></a>        <a href='../D/153.html' title='Multiple defined in 4 places.'>CHECK_UI</a> (sp+2);
<a id='L787' name='L787'></a>        (*p-&gt;mpX_set_si)
<a id='L788' name='L788'></a>          (sp,
<a id='L789' name='L789'></a>           (<strong class='reserved'>long</strong>) (* (mpexpr_fun_i_ternary_ui_t) <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;fun)
<a id='L790' name='L790'></a>           (sp, sp+1, (*p-&gt;mpX_get_ui) (sp+2)));
<a id='L791' name='L791'></a>        <strong class='reserved'>break</strong>;
<a id='L792' name='L792'></a>      <strong class='reserved'>default</strong>:
<a id='L793' name='L793'></a>        <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("unrecognised binary argument calling style",
<a id='L794' name='L794'></a>               <a href='../S/429.html#L37' title='Defined at 37 in demos/expr/expr.h.'>MPEXPR_RESULT_BAD_TABLE</a>);
<a id='L795' name='L795'></a>      <em class='brace'>}</em>
<a id='L796' name='L796'></a>    <em class='brace'>}</em>
<a id='L797' name='L797'></a>    <strong class='reserved'>break</strong>;
<a id='L798' name='L798'></a>
<a id='L799' name='L799'></a>  <strong class='reserved'>default</strong>:
<a id='L800' name='L800'></a>    <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("unrecognised operator type: 0x%X\n", <a href='../S/425.html#L274' title='Defined at 274 in demos/expr/expr.c.'>CP</a>-&gt;op-&gt;<a href='../D/4428.html' title='Multiple defined in 4 places.'>type</a>));
<a id='L801' name='L801'></a>    <a href='../S/425.html#L66' title='Defined at 66 in demos/expr/expr.c.'>ERROR</a> ("", <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>);
<a id='L802' name='L802'></a>  <em class='brace'>}</em>
<a id='L803' name='L803'></a>
<a id='L804' name='L804'></a> apply_control_done:
<a id='L805' name='L805'></a>  <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (<a href='../S/425.html#L46' title='Defined at 46 in demos/expr/expr.c.'>MPX_TRACE</a> ("result", <a href='../S/425.html#L83' title='Defined at 83 in demos/expr/expr.c.'>SP</a>));
<a id='L806' name='L806'></a>  <a href='../S/425.html#L304' title='Defined at 304 in demos/expr/expr.c.'>CONTROL_POP</a> ();
<a id='L807' name='L807'></a>  <strong class='reserved'>goto</strong> another_operator;
<a id='L808' name='L808'></a>
<a id='L809' name='L809'></a> done:
<a id='L810' name='L810'></a>  <strong class='reserved'>if</strong> (p-&gt;error_code == <a href='../S/429.html#L35' title='Defined at 35 in demos/expr/expr.h.'>MPEXPR_RESULT_OK</a>)
<a id='L811' name='L811'></a>    <em class='brace'>{</em>
<a id='L812' name='L812'></a>      <strong class='reserved'>if</strong> (p-&gt;data_top != 0)
<a id='L813' name='L813'></a>        <em class='brace'>{</em>
<a id='L814' name='L814'></a>          <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("data stack want top at 0, got %d\n", p-&gt;data_top));
<a id='L815' name='L815'></a>          p-&gt;error_code = <a href='../S/429.html#L38' title='Defined at 38 in demos/expr/expr.h.'>MPEXPR_RESULT_PARSE_ERROR</a>;
<a id='L816' name='L816'></a>        <em class='brace'>}</em>
<a id='L817' name='L817'></a>      <strong class='reserved'>else</strong>
<a id='L818' name='L818'></a>        (*p-&gt;mpX_set_or_swap) (p-&gt;res, <a href='../S/425.html#L83' title='Defined at 83 in demos/expr/expr.c.'>SP</a>);
<a id='L819' name='L819'></a>    <em class='brace'>}</em>
<a id='L820' name='L820'></a>
<a id='L821' name='L821'></a>  <em class='brace'>{</em>
<a id='L822' name='L822'></a>    <strong class='reserved'>int</strong>  i;
<a id='L823' name='L823'></a>    <strong class='reserved'>for</strong> (i = 0; i &lt; p-&gt;data_inited; i++)
<a id='L824' name='L824'></a>      <em class='brace'>{</em>
<a id='L825' name='L825'></a>        <a href='../D/1470.html' title='Multiple defined in 22 places.'>TRACE</a> (printf ("clear %d\n", i));
<a id='L826' name='L826'></a>        (*p-&gt;mpX_clear) (p-&gt;data_stack+i);
<a id='L827' name='L827'></a>      <em class='brace'>}</em>
<a id='L828' name='L828'></a>  <em class='brace'>}</em>
<a id='L829' name='L829'></a>
<a id='L830' name='L830'></a>  <a href='../S/425.html#L58' title='Defined at 58 in demos/expr/expr.c.'>FREE_FUNC_TYPE</a> (p-&gt;data_stack, p-&gt;data_alloc, <strong class='reserved'>union</strong> <a href='../S/434.html#L46' title='Defined at 46 in demos/expr/expr-impl.h.'>mpX_t</a>);
<a id='L831' name='L831'></a>  <a href='../S/425.html#L58' title='Defined at 58 in demos/expr/expr.c.'>FREE_FUNC_TYPE</a> (p-&gt;control_stack, p-&gt;control_alloc, <strong class='reserved'>struct</strong> <a href='../S/434.html#L81' title='Defined at 81 in demos/expr/expr-impl.h.'>mpexpr_control_t</a>);
<a id='L832' name='L832'></a>
<a id='L833' name='L833'></a>  <strong class='reserved'>return</strong> p-&gt;error_code;
<a id='L834' name='L834'></a><em class='brace'>}</em>
</pre>
<hr />
<a id='BOTTOM' name='BOTTOM'></a>
<em class='comment'>/* [&lt;][&gt;]<a href='#L148'>[^]</a><a href='#L371'>[v]</a><a href='#TOP'>[top]</a>[bottom]<a href='../mains.html'>[index]</a><a href='../help.html'>[help]</a> */</em>
</body>
</html>
